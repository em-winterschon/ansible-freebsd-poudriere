

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>User’s guide &mdash; ansible-role-freebsd-poudriere 1.4.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
        <link rel="copyright" title="Copyright" href="copyright.html"/>
    <link rel="top" title="ansible-role-freebsd-poudriere 1.4.0 documentation" href="index.html"/>
        <link rel="next" title="Example 1: Configure …" href="task-task1-ex1.html"/>
        <link rel="prev" title="Quick start guide" href="qsg.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> ansible-role-freebsd-poudriere
          

          
          </a>

          
            
            
              <div class="version">
                1.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="qsg.html">Quick start guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">User’s guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#playbook">Playbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="#debug">Debug</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tags">Tags</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tasks">Tasks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#development-and-testing">Development and testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#task1">task1</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#synopsis">Synopsis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#examples">Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id1">Examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#variables">Variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#default-variables">Default variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#default-os-specific-variables">Default OS specific variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custom-os-specific-variables">Custom OS specific variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#flavors-specific-variables-wip">Flavors specific variables (WIP)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#best-practice">Best practice</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#recommended-configuration-after-the-installation-of-os">Recommended configuration after the installation of OS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#flavors">Flavors</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="annotation.html">Annotated source code</a></li>
<li class="toctree-l1"><a class="reference internal" href="copyright.html">Copyright</a></li>
<li class="toctree-l1"><a class="reference internal" href="legalnotice.html">Legal Notice</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ansible-role-freebsd-poudriere</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>User’s guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/guide.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="user-s-guide">
<span id="ug"></span><h1><a class="toc-backref" href="#id2">User’s guide</a><a class="headerlink" href="#user-s-guide" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#user-s-guide" id="id2">User’s guide</a><ul>
<li><a class="reference internal" href="#introduction" id="id3">Introduction</a></li>
<li><a class="reference internal" href="#installation" id="id4">Installation</a></li>
<li><a class="reference internal" href="#playbook" id="id5">Playbook</a></li>
<li><a class="reference internal" href="#debug" id="id6">Debug</a></li>
<li><a class="reference internal" href="#tags" id="id7">Tags</a></li>
<li><a class="reference internal" href="#tasks" id="id8">Tasks</a><ul>
<li><a class="reference internal" href="#development-and-testing" id="id9">Development and testing</a></li>
<li><a class="reference internal" href="#task1" id="id10">task1</a><ul>
<li><a class="reference internal" href="#synopsis" id="id11">Synopsis</a></li>
<li><a class="reference internal" href="#examples" id="id12">Examples</a></li>
<li><a class="reference internal" href="#id1" id="id13">Examples</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#variables" id="id14">Variables</a><ul>
<li><a class="reference internal" href="#default-variables" id="id15">Default variables</a></li>
<li><a class="reference internal" href="#default-os-specific-variables" id="id16">Default OS specific variables</a></li>
<li><a class="reference internal" href="#custom-os-specific-variables" id="id17">Custom OS specific variables</a></li>
<li><a class="reference internal" href="#flavors-specific-variables-wip" id="id18">Flavors specific variables (WIP)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#best-practice" id="id19">Best practice</a><ul>
<li><a class="reference internal" href="#recommended-configuration-after-the-installation-of-os" id="id20">Recommended configuration after the installation of OS</a></li>
<li><a class="reference internal" href="#flavors" id="id21">Flavors</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<span id="ug-introduction"></span><h2><a class="toc-backref" href="#id3">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Ansible role: <a class="reference external" href="https://galaxy.ansible.com/vbotka/freebsd_poudriere/">freebsd_poudriere</a></li>
<li>Supported systems: <a class="reference external" href="https://www.freebsd.org/releases/">FreeBSD</a>, <a class="reference external" href="http://releases.ubuntu.com/">Ubuntu</a></li>
<li>Requirements: <a class="reference external" href="https://galaxy.ansible.com/vbotka/__REQUIREMENTS__">__REQUIREMENTS__</a></li>
</ul>
</div>
<div class="section" id="installation">
<span id="ug-installation"></span><h2><a class="toc-backref" href="#id4">Installation</a><a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>The most convenient way how to install an Ansible role is to use <span class="target" id="index-0"></span>Ansible Galaxy CLI
<code class="docutils literal notranslate"><span class="pre">ansible-galaxy</span></code>. The utility comes with the standard Ansible package and provides the user with a
simple interface to the Ansible Galaxy’s services. For example, take a look at the current status of
the role</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="go">shell&gt; ansible-galaxy info vbotka.freebsd_poudriere</span>
</span></pre></div>
</div>
<p>and install it</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="go"> shell&gt; ansible-galaxy install vbotka.freebsd_poudriere</span>
</span></pre></div>
</div>
<p>Install the requirements</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="go"> shell&gt; ansible-galaxy install vbotka.__REQUIREMENTS__</span>
</span></pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li>To install specific versions from various sources see <a class="reference external" href="https://galaxy.ansible.com/docs/using/installing.html">Installing content</a></li>
<li>Take a look at other roles <code class="docutils literal notranslate"><span class="pre">shell&gt;</span> <span class="pre">ansible-galaxy</span> <span class="pre">search</span> <span class="pre">--author=vbotka</span></code></li>
</ul>
</div>
</div>
<div class="section" id="playbook">
<span id="ug-playbook"></span><h2><a class="toc-backref" href="#id5">Playbook</a><a class="headerlink" href="#playbook" title="Permalink to this headline">¶</a></h2>
<p>Below is a simple playbook that calls this role (10) at a single host srv.example.com (2)</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">shell&gt; cat playbook.yml</span>
<span class="hll"><span class="l l-Scalar l-Scalar-Plain">- hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">srv.example.com</span>
</span>  <span class="l l-Scalar l-Scalar-Plain">gather_facts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="l l-Scalar l-Scalar-Plain">connection</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ssh</span>
  <span class="l l-Scalar l-Scalar-Plain">remote_user</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">admin</span>
  <span class="l l-Scalar l-Scalar-Plain">become</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="l l-Scalar l-Scalar-Plain">become_user</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
  <span class="l l-Scalar l-Scalar-Plain">become_method</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">sudo</span>
  <span class="l l-Scalar l-Scalar-Plain">roles</span><span class="p p-Indicator">:</span>
<span class="hll">    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">vbotka.freebsd_poudriere</span>
</span></pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">gather_facts:</span> <span class="pre">true</span></code> (3) must be set to gather facts needed to evaluate
<span class="target" id="index-1"></span>OS-specific options of the role. For example, to install packages, the variable
<code class="docutils literal notranslate"><span class="pre">ansible_os_family</span></code> is needed to select the appropriate Ansible module.</p>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li>For details see <a class="reference external" href="https://docs.ansible.com/ansible/latest/plugins/connection.html">Connection Plugins</a> (4-5)</li>
<li>See also <a class="reference external" href="https://docs.ansible.com/ansible/latest/user_guide/become.html#understanding-privilege-escalation">Understanding Privilege Escalation</a> (6-8)</li>
</ul>
</div>
</div>
<div class="section" id="debug">
<span id="ug-debug"></span><h2><a class="toc-backref" href="#id6">Debug</a><a class="headerlink" href="#debug" title="Permalink to this headline">¶</a></h2>
<p>Some tasks will display additional information when the variable <span class="target" id="index-2"></span>XY_debug is
enabled. Enable debug output either in the configuration</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="nt">XY_debug</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</span></pre></div>
</div>
<p>, or set the extra variable in the command</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="go">shell&gt; ansible-playbook playbook.yml -e XY_debug=true</span>
</span></pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>The debug output of this role is optimized for the <strong>yaml</strong> callback plugin. Set this plugin
for example in the environment <code class="docutils literal notranslate"><span class="pre">shell&gt;</span> <span class="pre">export</span> <span class="pre">ANSIBLE_STDOUT_CALLBACK=yaml</span></code></li>
<li>See details about the yaml callback plugin <code class="docutils literal notranslate"><span class="pre">shell&gt;</span> <span class="pre">ansible-doc</span> <span class="pre">-t</span> <span class="pre">callback</span> <span class="pre">yaml</span></code></li>
<li>See list of other callback plugins <code class="docutils literal notranslate"><span class="pre">shell&gt;</span> <span class="pre">ansible-doc</span> <span class="pre">-t</span> <span class="pre">callback</span> <span class="pre">-l</span></code></li>
</ul>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><a class="reference external" href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_debugger.html">Playbook Debugger</a></li>
<li><a class="reference external" href="https://docs.ansible.com/ansible/latest/dev_guide/debugging.html#debugging-modules">Debugging modules</a></li>
<li><a class="reference external" href="https://realpython.com/python-debugging-pdb/">Python Debugging With Pdb</a></li>
</ul>
</div>
</div>
<div class="section" id="tags">
<span id="ug-tags"></span><h2><a class="toc-backref" href="#id7">Tags</a><a class="headerlink" href="#tags" title="Permalink to this headline">¶</a></h2>
<p>The <span class="target" id="index-3"></span>tags provide the user with a very useful tool to run selected tasks of the role. To see
what tags are available list the tags of the role with the command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="hll">shell&gt; ansible-playbook freebsd-poudriere.yml --list-tags
</span>
playbook: freebsd-poudriere.yml

play <span class="c1">#1 (srv.example.com): srv.example.com TAGS: []</span>
   TASK TAGS: <span class="o">[</span>always, ... <span class="o">]</span>
</pre></div>
</div>
<p>For example, display the list of the variables and their values with the tag <code class="docutils literal notranslate"><span class="pre">XY_debug</span></code> (when the
debug is enabled <code class="docutils literal notranslate"><span class="pre">XY_debug:</span> <span class="pre">true</span></code>)</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="go"> shell&gt; ansible-playbook playbook.yml -t XY_debug</span>
</span></pre></div>
</div>
<p>See what packages will be installed</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="go"> shell&gt; ansible-playbook playbook.yml -t XY_packages --check</span>
</span></pre></div>
</div>
<p>Install packages and exit the play</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="go"> shell&gt; ansible-playbook playbook.yml -t XY_packages</span>
</span></pre></div>
</div>
</div>
<div class="section" id="tasks">
<span id="ug-tasks"></span><h2><a class="toc-backref" href="#id8">Tasks</a><a class="headerlink" href="#tasks" title="Permalink to this headline">¶</a></h2>
<p>The description of the tasks is not complete. The <a class="reference external" href="https://galaxy.ansible.com/vbotka/freebsd_poudriere/">role</a> and the documentation is work in progess. Feel free to <a class="reference external" href="https://github.com/vbotka/ansible-freebsd-poudriere/issues">share your feedback and report issues</a>.</p>
<p><a class="reference external" href="https://github.com/firstcontributions/first-contributions">Contributions are welcome</a>.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li>Source code <a class="reference internal" href="annotation-tasks.html#as-main-yml"><span class="std std-ref">main.yml</span></a></li>
</ul>
</div>
<div class="section" id="development-and-testing">
<h3><a class="toc-backref" href="#id9">Development and testing</a><a class="headerlink" href="#development-and-testing" title="Permalink to this headline">¶</a></h3>
<p>In order to deliver an Ansible project it’s necessary to test the code and configuration. The tags
provide the administrators with a tool to test single tasks’ files and single tasks. For example, to
test single tasks at single remote host <em>test_01</em>, create a playbook</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="l l-Scalar l-Scalar-Plain">shell&gt; cat playbook.yml</span>
</span><span class="l l-Scalar l-Scalar-Plain">- hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">test_01</span>
  <span class="l l-Scalar l-Scalar-Plain">become</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="l l-Scalar l-Scalar-Plain">roles</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">vbotka.freebsd_poudriere</span>
</pre></div>
</div>
<p>Customize configuration in <code class="docutils literal notranslate"><span class="pre">host_vars/test_01/XY-*.yml</span></code> and <span class="target" id="index-4"></span>check the syntax</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="go">shell&gt; ansible-playbook playbook.yml --syntax-check</span>
</span></pre></div>
</div>
<p>Then <span class="target" id="index-5"></span>dry-run the selected task and see what will be changed. Replace &lt;tag&gt; with valid tag
or with a comma-separated list of tags</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="go">shell&gt; ansible-playbook playbook.yml -t &lt;tag&gt; --check --diff</span>
</span></pre></div>
</div>
<p>When all seems to be ready run the command. Run the command twice and make sure the playbook and the
configuration is <span class="target" id="index-6"></span>idempotent</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="go">shell&gt; ansible-playbook playbook.yml -t &lt;tag&gt;</span>
</span></pre></div>
</div>
</div>
<div class="section" id="task1">
<span id="ug-task-task1"></span><h3><a class="toc-backref" href="#id10">task1</a><a class="headerlink" href="#task1" title="Permalink to this headline">¶</a></h3>
<div class="section" id="synopsis">
<h4><a class="toc-backref" href="#id11">Synopsis</a><a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h4>
<p>Configuration of …</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<ul class="last simple">
<li>Quoting from <a class="reference external" href="https://core.docs.ubuntu.com/en/stacks/network/network-manager/docs/">About NetworkManager</a>:
“By default network management on Ubuntu Core is handled by
systemd’s networkd and netplan. However, when NetworkManager is
installed, it will take control of all networking devices in the
system by creating a netplan configuration file in which it sets
itself as the default network renderer.”</li>
</ul>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li>Annotated Source code <span class="xref std std-ref">as_task1.yml</span></li>
<li>Project website <a class="reference external" href="https://netplan.io/">netplan.io</a></li>
</ul>
</div>
</div>
<div class="section" id="examples">
<h4><a class="toc-backref" href="#id12">Examples</a><a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="id1">
<h4><a class="toc-backref" href="#id13">Examples</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<div class="toctree-wrapper compound" id="task1-toc">
<ul>
<li class="toctree-l1"><a class="reference internal" href="task-task1-ex1.html">Example 1: Configure …</a></li>
<li class="toctree-l1"><a class="reference internal" href="task-task1-ex2.html">Example 2: Configure …</a></li>
</ul>
</div>
</div>
</div>
</div>
<div class="section" id="variables">
<span id="ug-vars"></span><h2><a class="toc-backref" href="#id14">Variables</a><a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h2>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><a class="reference external" href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_variables.html#variable-precedence-where-should-i-put-a-variable">Ansible variable precedence: Where should I put a variable?</a></li>
</ul>
</div>
<div class="section" id="default-variables">
<span id="ug-vars-defaults"></span><h3><a class="toc-backref" href="#id15">Default variables</a><a class="headerlink" href="#default-variables" title="Permalink to this headline">¶</a></h3>
<p>The common variables for all distributions are in the file
<code class="docutils literal notranslate"><span class="pre">defaults/main.yml</span></code>. These variables can be customized in the file
<code class="docutils literal notranslate"><span class="pre">vars/main.yml</span></code>. The file <code class="docutils literal notranslate"><span class="pre">vars/main.yml</span></code> will be preserved by the
update of the role.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<ul class="last simple">
<li>Don’t make any changes to the file <em>defaults/main.yml</em>. The
changes will be overwritten by the update of the role. Customize
the default values in the file <em>vars/main.yml</em>.</li>
<li>Default value of <em>XY_passwords_debug_classified</em> and
<em>XY_task1_debug_classified</em> is <em>False</em>. Passwords will be
displayed if these variables are enabled.</li>
</ul>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li>The examples of the customization <code class="docutils literal notranslate"><span class="pre">vars/main.yml.sample</span></code></li>
</ul>
</div>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-freebsd-poudriere/blob/master/defaults/main.yml">defaults/main.yml</a>]</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="hll"><span class="c1"># defaults freebsd_poudriere</span>
</span>
<span class="nt">poudriere_install</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="nt">poudriere_debug</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="nt">poudriere_backup_conf</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="c1"># freebsd_install_method: packages</span>
<span class="nt">freebsd_install_method</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ports</span>
<span class="nt">freebsd_use_packages</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="nt">freebsd_install_retries</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="nt">freebsd_install_delay</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>

<span class="nt">poudriere_packages</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ports-mgmt/poudriere</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ports-mgmt/portmaster</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">devel/ccache</span>
<span class="nt">poudriere_packages_cert</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">security/py-openssl</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">security/py-acme-tiny</span>

<span class="c1"># owner, group, mode</span>
<span class="nt">poudriere_owner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="nt">poudriere_group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">wheel</span>
<span class="nt">poudriere_mode</span><span class="p">:</span> <span class="s">&quot;0644&quot;</span>
<span class="nt">poudriere_mode_dir</span><span class="p">:</span> <span class="s">&quot;0755&quot;</span>
<span class="c1"># ssl</span>
<span class="nt">poudriere_cert_create</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="nt">poudriere_ssl_dir</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/local/etc/ssl</span>
<span class="nt">poudriere_ssl_dir_mode</span><span class="p">:</span> <span class="s">&quot;0755&quot;</span>
<span class="nt">poudriere_ssl_private_dir_mode</span><span class="p">:</span> <span class="s">&quot;0700&quot;</span>
<span class="nt">poudriere_ssl_private_key_mode</span><span class="p">:</span> <span class="s">&quot;0600&quot;</span>
<span class="nt">poudriere_cert_CN</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">builder.example.com</span>
<span class="nt">poudriere_cert_path</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">poudriere_ssl_dir</span><span class="nv"> </span><span class="s">}}/crt/poudriere.crt&quot;</span>
<span class="c1"># poudriere.conf (see /usr/local/etc/poudriere.conf.sample)</span>
<span class="nt">poudriere_conf</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/local/etc/poudriere.conf</span>
<span class="nt">poudriere_conf_dir</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/local/etc/poudriere.d</span>
<span class="nt">poudriere_conf_NO_ZFS</span><span class="p">:</span> <span class="s">&quot;yes&quot;</span>
<span class="nt">poudriere_conf_ZPOOL</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tank</span>
<span class="nt">poudriere_conf_ZROOTFS</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/poudriere</span>
<span class="nt">poudriere_conf_FREEBSD_HOST</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://download.freebsd.org</span>
<span class="nt">poudriere_conf_RESOLV_CONF</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/resolv.conf</span>
<span class="nt">poudriere_conf_BASEFS</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/local/poudriere</span>
<span class="nt">poudriere_conf_POUDRIERE_DATA</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">poudriere_conf_BASEFS</span><span class="nv"> </span><span class="s">}}/data&quot;</span>
<span class="nt">poudriere_conf_USE_PORTLINT</span><span class="p">:</span> <span class="s">&quot;no&quot;</span>
<span class="nt">poudriere_conf_USE_TMPFS</span><span class="p">:</span> <span class="s">&quot;yes&quot;</span>
<span class="nt">poudriere_conf_DISTFILES_CACHE</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/ports/distfiles</span>
<span class="nt">poudriere_conf_PKG_REPO_SIGNING_KEY</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">poudriere_ssl_dir</span><span class="nv"> </span><span class="s">}}/private/poudriere.pem&quot;</span>
<span class="nt">poudriere_conf_URL_BASE</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ansible_default_ipv4.address</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">default(&#39;127.0.0.1&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="nt">poudriere_conf_CHECK_CHANGED_OPTIONS</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">verbose</span>
<span class="nt">poudriere_conf_CHECK_CHANGED_DEPS</span><span class="p">:</span> <span class="s">&quot;yes&quot;</span>

<span class="c1"># {{ poudriere_conf_dir }}/make.conf</span>
<span class="nt">poudriere_make_conf</span><span class="p">:</span> <span class="p p-Indicator">[]</span>

<span class="nt">poudriere_pkglist_dir</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">poudriere_conf_dir</span><span class="nv"> </span><span class="s">}}/pkglist&quot;</span>
<span class="nt">poudriere_pkg_arch</span><span class="p">:</span> <span class="p p-Indicator">[]</span>
<span class="nt">pkg_dict</span><span class="p">:</span> <span class="p p-Indicator">[]</span>


<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="default-os-specific-variables">
<span id="ug-vars-os-defaults"></span><h3><a class="toc-backref" href="#id16">Default OS specific variables</a><a class="headerlink" href="#default-os-specific-variables" title="Permalink to this headline">¶</a></h3>
<p>The files in the directories <code class="docutils literal notranslate"><span class="pre">vars/defaults</span></code> and
<code class="docutils literal notranslate"><span class="pre">vars/defaults.incr</span></code> keep <span class="target" id="index-7"></span>OS specific variables. The difference
between them is the method how the files are included.</p>
<blockquote>
<div><ul class="simple">
<li><strong>firstfound</strong>: A file in the directory <code class="docutils literal notranslate"><span class="pre">vars/defaults</span></code> in the
order <code class="docutils literal notranslate"><span class="pre">ansible_distribution_release</span></code>, <code class="docutils literal notranslate"><span class="pre">ansible_distribution</span></code>,
and <code class="docutils literal notranslate"><span class="pre">ansible_os_family</span></code> is included with the <em>lookup plugin</em>
<code class="docutils literal notranslate"><span class="pre">first_found</span></code>.</li>
<li><strong>incremental</strong>: All files in the directory <code class="docutils literal notranslate"><span class="pre">vars/defaults.incr</span></code>
in the order <code class="docutils literal notranslate"><span class="pre">ansible_os_family</span></code>, <code class="docutils literal notranslate"><span class="pre">ansible_distribution</span></code>, and
<code class="docutils literal notranslate"><span class="pre">ansible_distribution_release</span></code> are included in the <em>loop</em>. The
variables in the files overwrite each other.</li>
</ul>
</div></blockquote>
<p>In addition, also files <code class="docutils literal notranslate"><span class="pre">defaults.yml</span></code> and/or <code class="docutils literal notranslate"><span class="pre">default.yml</span></code> can be
included.</p>
<p>The method is determined by the variable <code class="docutils literal notranslate"><span class="pre">XY_vars_distro</span></code> <em>(default:
firstfound)</em></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="nt">XY_vars_distro</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">firstfound</span>
</span></pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<ul class="last simple">
<li>Don’t change these file. The changes will be overwritten by the
update of the role. Customize the default OS values in the files
placed in the directory <code class="docutils literal notranslate"><span class="pre">vars/</span></code></li>
</ul>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li>Annotated Source code <span class="xref std std-ref">as_vars.yml</span></li>
<li>Annotated Source code <span class="xref std std-ref">as_vars_firstfound.yml</span></li>
<li>Annotated Source code <span class="xref std std-ref">as_vars_incremental.yml</span></li>
</ul>
</div>
</div>
<div class="section" id="custom-os-specific-variables">
<span id="ug-vars-os-custom"></span><h3><a class="toc-backref" href="#id17">Custom OS specific variables</a><a class="headerlink" href="#custom-os-specific-variables" title="Permalink to this headline">¶</a></h3>
<p>Os specific variables can be customized in files placed in the
directory <code class="docutils literal notranslate"><span class="pre">vars/</span></code>. These files will be preserved by the update.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li>The examples of the customization <code class="docutils literal notranslate"><span class="pre">vars/defaults.yml.sample</span></code></li>
</ul>
</div>
</div>
<div class="section" id="flavors-specific-variables-wip">
<span id="ug-vars-flavors"></span><h3><a class="toc-backref" href="#id18">Flavors specific variables (WIP)</a><a class="headerlink" href="#flavors-specific-variables-wip" title="Permalink to this headline">¶</a></h3>
<p>The files in the directories <code class="docutils literal notranslate"><span class="pre">vars/flavors</span></code> and
<code class="docutils literal notranslate"><span class="pre">vars/flavors.incr</span></code> keep <span class="target" id="index-8"></span>flavors specific variables. The difference
between them is the method how the files are included.</p>
<blockquote>
<div><ul class="simple">
<li><strong>firstfound</strong>: A file in the directory <code class="docutils literal notranslate"><span class="pre">vars/flavors</span></code> in the
order &lt;TBD&gt; is included with the <em>lookup plugin</em> <code class="docutils literal notranslate"><span class="pre">first_found</span></code>.</li>
<li><strong>incremental</strong>: All files in the directory <code class="docutils literal notranslate"><span class="pre">vars/defaults.incr</span></code>
in the order &lt;TBD&gt; are included in the <em>loop</em>. The variables in
the files overwrite each other.</li>
</ul>
</div></blockquote>
<p>In addition, also files <code class="docutils literal notranslate"><span class="pre">defaults.yml</span></code> and/or <code class="docutils literal notranslate"><span class="pre">default.yml</span></code> can be
included.</p>
<p>The method is determined by the variable <code class="docutils literal notranslate"><span class="pre">XY_vars_flavor</span></code> <em>(default:
firstfound)</em></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="nt">XY_vars_flavor</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">firstfound</span>
</span></pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li>Annotated Source code <span class="xref std std-ref">XY_vars_flavors.yml</span></li>
<li>Annotated Source code <span class="xref std std-ref">XY_vars_flavors_common.yml</span></li>
</ul>
</div>
</div>
</div>
<div class="section" id="best-practice">
<span id="ug-bp"></span><h2><a class="toc-backref" href="#id19">Best practice</a><a class="headerlink" href="#best-practice" title="Permalink to this headline">¶</a></h2>
<div class="section" id="recommended-configuration-after-the-installation-of-os">
<span id="ug-bp-firstboot"></span><h3><a class="toc-backref" href="#id20">Recommended configuration after the installation of OS</a><a class="headerlink" href="#recommended-configuration-after-the-installation-of-os" title="Permalink to this headline">¶</a></h3>
<p>Test syntax</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="go">shell&gt; ansible-playbook playbook.yml --syntax-check</span>
</span></pre></div>
</div>
<p>See what variables will be included</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="go">shell&gt; ansible-playbook playbook.yml -t XY_debug -e XY_debug=true</span>
</span></pre></div>
</div>
<p><span class="target" id="index-9"></span>Dry-run, display differences and display variables</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="go">shell&gt; ansible-playbook playbook.yml -e XY_debug=true --check --diff</span>
</span></pre></div>
</div>
<p>Configure hostname, users, sudoers, network and reboot</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="go">shell&gt; ansible-playbook playbook.yml -t XY_task1</span>
</span></pre></div>
</div>
<p>Test the installation of packages</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="go">shell&gt; ansible-playbook playbook.yml -t XY_packages -e XY_package_install_dryrun=true</span>
</span></pre></div>
</div>
<p>Install packages</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="go">shell&gt; ansible-playbook playbook.yml -t XY_packages</span>
</span></pre></div>
</div>
<p>Run the playbook</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="go">shell&gt; ansible-playbook playbook.yml</span>
</span></pre></div>
</div>
<p>Test the <span class="target" id="index-10"></span>idem-potency. The role and the configuration data shall be idempotent. Once the
installation and configuration have passed there should be no changes reported by <em>ansible-playbook</em>
when running the playbook repeatedly. Disable debug, and install to speedup the playbook and run the
playbook again.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="go"> shell&gt; ansible-playbook playbook.yml</span>
</span></pre></div>
</div>
</div>
<div class="section" id="flavors">
<span id="ug-bp-flavors"></span><h3><a class="toc-backref" href="#id21">Flavors</a><a class="headerlink" href="#flavors" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>&lt;TBD&gt;</div></blockquote>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="task-task1-ex1.html" class="btn btn-neutral float-right" title="Example 1: Configure …" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="qsg.html" class="btn btn-neutral" title="Quick start guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; <a href="copyright.html">Copyright</a> 2022, Vladimir Botka.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.4.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>